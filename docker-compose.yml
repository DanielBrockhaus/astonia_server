version: "3.7"
services:
  db:
    image: mariadb:latest
    restart: always
    secrets:
      - database_password
    environment:
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/database_password
      MYSQL_TCP_PORT: ${DATABASE_PORT}
      MYSQL_UNIX_PORT: ${DATABASE_PORT}
    ports:
      - "${DATABASE_PORT}:${DATABASE_PORT}"
    volumes:
      - './migrations/create_tables.sql:/docker-entrypoint-initdb.d/01-createtables.sql'
      - './migrations/merc.sql:/docker-entrypoint-initdb.d/02-merc.sql'
      - './migrations/storage.sql:/docker-entrypoint-initdb.d/03-storage.sql'
    healthcheck:
      interval: 10s
      start_interval: 0.5s
      start_period: 30s
      retries: 3
      test:
        [
          "CMD",
          "healthcheck.sh",
          "--su-mysql",
          "--connect",
          "--innodb_initialized"
        ]
      timeout: 30s
  cameron:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_DATABASE_USER: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6656:6656"
    command: ["-a 1", "-p6656", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  under_aston:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6657:6657"
    command: ["-a 2", "-p6657", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  aston:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6658:6658"
    command: ["-a 3", "-p6658", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  earth_pents:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6659:6659"
    command: ["-a 4", "-p6659", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  sewers:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6660:6660"
    command: ["-a 5", "-p6660", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  earth_underground:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6661:6661"
    command: ["-a 6", "-p6661", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  fire_pents:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6662:6662"
    command: ["-a 7", "-p6662", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  fire_underground:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6663:6663"
    command: ["-a 8", "-p6663", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  ice_pents:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6664:6664"
    command: ["-a 9", "-p6664", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  ice_underground:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6665:6665"
    command: ["-a 10", "-p6665", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  ice_palace:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6666:6666"
    command: ["-a 11", "-p6666", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  mines:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6667:6667"
    command: ["-a 12", "-p6667", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  catacombs:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6668:6668"
    command: ["-a 13", "-p6668", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  random_dungeons:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6669:6669"
    command: ["-a 14", "-p6669", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  swamps:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6670:6670"
    command: ["-a 15", "-p6670", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  exkordon_forest:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6671:6671"
    command: ["-a 16", "-p6671", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  exkordon:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6672:6672"
    command: ["-a 17", "-p6672", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  bone_tower:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6673:6673"
    command: ["-a 18", "-p6673", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  nomad_plains:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6674:6674"
    command: ["-a 19", "-p6674", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  live_quest:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6675:6675"
    command: ["-a 20", "-p6675", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  test_pents:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6676:6676"
    command: ["-a 21", "-p6676", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  labyrinth:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6677:6677"
    command: ["-a 22", "-p6677", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  ice_army_cave:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6678:6678"
    command: ["-a 23", "-p6678", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  more_ice_army_caves:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6679:6679"
    command: ["-a 24", "-p6679", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  rodneys_warped_world:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6680:6680"
    command: ["-a 25", "-p6680", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  below_aston_2:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6681:6681"
    command: ["-a 26", "-p6681", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  brannington_forest:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6683:6683"
    command: ["-a 28", "-p6683", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  brannington:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6684:6684"
    command: ["-a 29", "-p6684", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  clan_spawners:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6685:6685"
    command: ["-a 30", "-p6685", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  grimroot:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6686:6686"
    command: ["-a 31", "-p6686", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  jobbington:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6687:6687"
    command: ["-a 32", "-p6687", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  long_tunnel:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6688:6688"
    command: ["-a 33", "-p6688", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  teufelheim:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6689:6689"
    command: ["-a 34", "-p6689", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  caligar:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6691:6691"
    command: ["-a 36", "-p6691", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  arkhata:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
      ASTONIA_USERNAME: ${DATABASE_USERNAME}
      ASTONIA_DATABASE_PORT: ${DATABASE_PORT}
      ASTONIA_DATABASE_PASSWORD_FILE: /run/secrets/database_password
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "6692:6692"
    command: ["-a 37", "-p6692", "-b${ASTONIA_3_SERVER_ADDRESS}"]
    configs:
      - source: message_of_the_day
        target: /opt/var/astonia/motd.txt
    secrets:
      - database_password
  chat:
    build:
      context: .
    environment:
      ASTONIA_DATABASE_HOSTNAME: ${DATABASE_HOSTNAME}
    ports:
      - "6654:6654"
    expose:
      - "6654"
    entrypoint: ["/opt/var/astonia/chatserver"]

configs:
  message_of_the_day:
    content: |
      Using /punish or /shutup or /exterminate is strictly forbidden. You're here to test, not to fool around.

secrets:
  database_password:
    environment: "DATABASE_PASSWORD"